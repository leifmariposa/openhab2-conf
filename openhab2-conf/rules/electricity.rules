// Electricity
rule "Watt"
when
  Item electricity changed
then
  var String power  = transform("JSONPATH", "$.Watt", (electricity.state).toString)
  electricity_consumption.postUpdate(power)

  var String kwh  = transform("JSONPATH", "$.kWh", (electricity.state).toString)
  electricity_total.postUpdate((kwh).toString)
end

rule "kWh"
when
  Item electricity_total changed
then
  var date	= now.getDayOfMonth

  if (electricity_at_midnight.state === NULL) {
    electricity_at_midnight.postUpdate((electricity_total.state).toString)
  }

  if (electricity_current_date.state != date) {
    electricity_current_date.postUpdate((date).toString)
    electricity_at_midnight.postUpdate((electricity_total.state).toString)
  }

  electricity_today.postUpdate(((electricity_total.state as Number) - (electricity_at_midnight.state as Number)).toString)
  energy_cost_today.postUpdate((electricity_today.state as Number) * 2.0) // 2.0 Skr/kWh
end

